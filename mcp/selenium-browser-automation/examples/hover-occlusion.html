<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test: Hover Occlusion Detection</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    h1 {
      color: #1a1a1a;
      border-bottom: 3px solid #f44336;
      padding-bottom: 10px;
    }

    .intro {
      background: #ffebee;
      padding: 15px;
      border-left: 4px solid #f44336;
      margin: 20px 0;
    }

    .test-case {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin: 20px 0;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .test-case h2 {
      color: #333;
      font-size: 20px;
      margin-top: 0;
      display: flex;
      align-items: center;
    }

    .test-number {
      background: #f44336;
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-size: 14px;
      font-weight: bold;
    }

    .test-number.pass {
      background: #4caf50;
    }

    .expected {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 12px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .expected::before {
      content: "Expected: ";
      font-weight: bold;
      color: #e65100;
    }

    .expected.should-fail::before {
      content: "Expected: SHOULD FAIL - ";
      color: #c62828;
    }

    .expected.should-pass::before {
      content: "Expected: SHOULD PASS - ";
      color: #2e7d32;
    }

    .actual {
      background: #f9f9f9;
      border: 2px dashed #f44336;
      padding: 20px;
      margin: 15px 0;
      position: relative;
      min-height: 120px;
    }

    .actual::before {
      content: "Test Element:";
      position: absolute;
      top: -10px;
      left: 10px;
      background: white;
      padding: 0 5px;
      font-size: 12px;
      color: #666;
    }

    .technique-tag {
      display: inline-block;
      background: #ffcdd2;
      color: #c62828;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-family: monospace;
      margin: 5px 5px 5px 0;
    }

    .technique-tag.pass {
      background: #c8e6c9;
      color: #2e7d32;
    }

    /* Test button base styles */
    .hover-test-btn {
      padding: 15px 30px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #e0e0e0;
      position: relative;
      z-index: 1;
    }

    .hover-test-btn:hover {
      background-color: #4caf50 !important;
      color: white !important;
    }

    /* Overlay styles */
    .overlay {
      position: absolute;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
    }

    .modal-content {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 8px;
      z-index: 1001;
      display: none;
    }

    /* Container for relative positioning */
    .test-container {
      position: relative;
      display: inline-block;
    }
  </style>
</head>
<body>

<!--
================================================================================
TEST FILE METADATA
================================================================================
FILE: hover-occlusion.html
PURPOSE: Validate pointer events check (elementFromPoint) before hover
TECHNICAL: Uses document.elementFromPoint() at element center to detect occlusion
TEST COUNT: 8 occlusion scenarios (5 should fail, 3 should pass)
EXPECTED RESULT: Obscured elements rejected with clear error
ERROR MESSAGE: "Element '#selector' is obscured by another element at its center"
UPDATED: 2025-12-30
================================================================================
-->

  <h1>Hover Occlusion Detection Tests</h1>

  <div class="intro">
    <p><strong>Purpose:</strong> Validate that the <code>hover()</code> tool correctly detects when elements are obscured by overlays.</p>
    <p><strong>Method:</strong> Uses <code>document.elementFromPoint(x, y)</code> at element center to verify the target element receives pointer events.</p>
    <p><strong>Expected:</strong> Obscured elements should fail with error "Element is obscured by another element at its center".</p>
    <p><strong>Note:</strong> Tests 1-5 are expected to FAIL (element obscured). Tests 6-8 should PASS.</p>
  </div>

  <!-- ===================================================================== -->
  <!-- TEST 1: Full Modal Overlay (SHOULD FAIL)                              -->
  <!-- ===================================================================== -->

  <section id="test-1" class="test-case">
    <h2>
      <span class="test-number">1</span>
      Full Modal Overlay
    </h2>
    <span class="technique-tag">Fixed overlay</span>
    <span class="technique-tag">SHOULD FAIL</span>

    <div class="expected should-fail">
      Element is covered by a modal overlay. elementFromPoint() returns the overlay, not the button.
    </div>

    <div class="actual">
      <button onclick="showModal()" style="margin-bottom: 10px; padding: 10px;">Show Modal Overlay</button>
      <br>
      <button id="modal-covered-btn" class="hover-test-btn" style="background: #ff5722; color: white;">
        Hover Occlusion Test 1: Button covered by modal (SHOULD FAIL when modal shown)
      </button>
    </div>
  </section>

  <!-- Modal overlay (hidden by default) -->
  <div id="modal-overlay" class="modal-overlay" onclick="hideModal()"></div>
  <div id="modal-content" class="modal-content">
    <h3>Modal Dialog</h3>
    <p>This modal covers the button below. Attempting to hover the button should fail.</p>
    <button onclick="hideModal()">Close Modal</button>
  </div>

  <!-- ===================================================================== -->
  <!-- TEST 2: Partial Overlay (Center Covered) (SHOULD FAIL)                -->
  <!-- ===================================================================== -->

  <section id="test-2" class="test-case">
    <h2>
      <span class="test-number">2</span>
      Partial Overlay (Center Covered)
    </h2>
    <span class="technique-tag">Covers center only</span>
    <span class="technique-tag">SHOULD FAIL</span>

    <div class="expected should-fail">
      Overlay covers only the center of the button. Since pointer check uses center coordinates, this should fail.
    </div>

    <div class="actual">
      <div class="test-container">
        <button id="center-covered-btn" class="hover-test-btn" style="background: #9c27b0; color: white; width: 200px;">
          Hover Occlusion Test 2: Center covered
        </button>
        <div class="overlay" style="top: 20px; left: 50px; width: 100px; height: 30px;"></div>
      </div>
    </div>
  </section>

  <!-- ===================================================================== -->
  <!-- TEST 3: Transparent Overlay (SHOULD FAIL)                             -->
  <!-- ===================================================================== -->

  <section id="test-3" class="test-case">
    <h2>
      <span class="test-number">3</span>
      Transparent Overlay (opacity < 1)
    </h2>
    <span class="technique-tag">Semi-transparent overlay</span>
    <span class="technique-tag">SHOULD FAIL</span>

    <div class="expected should-fail">
      Overlay is semi-transparent (opacity: 0.3) but still blocks pointer events. elementFromPoint() still returns the overlay.
    </div>

    <div class="actual">
      <div class="test-container">
        <button id="transparent-overlay-btn" class="hover-test-btn" style="background: #00bcd4; color: white;">
          Hover Occlusion Test 3: Transparent overlay
        </button>
        <div class="overlay" style="top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 0, 0, 0.3);"></div>
      </div>
    </div>
  </section>

  <!-- ===================================================================== -->
  <!-- TEST 4: Dropdown Menu Covering (SHOULD FAIL)                          -->
  <!-- ===================================================================== -->

  <section id="test-4" class="test-case">
    <h2>
      <span class="test-number">4</span>
      Dropdown Menu Covering
    </h2>
    <span class="technique-tag">Dropdown overlay</span>
    <span class="technique-tag">SHOULD FAIL when open</span>

    <div class="expected should-fail">
      When dropdown is open, it covers the target button. Should fail when dropdown is visible.
    </div>

    <div class="actual">
      <div class="test-container" style="display: block;">
        <button onclick="toggleDropdown()" style="margin-bottom: 5px; padding: 10px;">Toggle Dropdown</button>
        <div id="dropdown-menu" style="display: none; position: absolute; background: white; border: 1px solid #ccc; padding: 10px; z-index: 100; width: 200px;">
          <p style="margin: 0;">Dropdown menu item 1</p>
          <p style="margin: 0;">Dropdown menu item 2</p>
          <p style="margin: 0;">Dropdown menu item 3</p>
        </div>
        <br>
        <button id="dropdown-covered-btn" class="hover-test-btn" style="background: #673ab7; color: white; margin-top: 10px;">
          Hover Occlusion Test 4: Covered by dropdown
        </button>
      </div>
    </div>
  </section>

  <!-- ===================================================================== -->
  <!-- TEST 5: Toast Notification Covering (SHOULD FAIL)                     -->
  <!-- ===================================================================== -->

  <section id="test-5" class="test-case">
    <h2>
      <span class="test-number">5</span>
      Toast Notification
    </h2>
    <span class="technique-tag">Toast overlay</span>
    <span class="technique-tag">SHOULD FAIL when toast visible</span>

    <div class="expected should-fail">
      Toast notification appears on top of the button. Should fail while toast is visible.
    </div>

    <div class="actual">
      <button onclick="showToast()" style="margin-bottom: 10px; padding: 10px;">Show Toast</button>
      <br>
      <div class="test-container">
        <button id="toast-covered-btn" class="hover-test-btn" style="background: #ff9800; color: white;">
          Hover Occlusion Test 5: Covered by toast
        </button>
        <div id="toast" style="display: none; position: absolute; top: 0; left: 0; right: 0; background: #333; color: white; padding: 15px; text-align: center; z-index: 100;">
          Toast notification message!
        </div>
      </div>
    </div>
  </section>

  <!-- ===================================================================== -->
  <!-- TEST 6: Overlay with pointer-events: none (SHOULD PASS)               -->
  <!-- ===================================================================== -->

  <section id="test-6" class="test-case">
    <h2>
      <span class="test-number pass">6</span>
      Overlay with pointer-events: none
    </h2>
    <span class="technique-tag pass">pointer-events: none on overlay</span>
    <span class="technique-tag pass">SHOULD PASS</span>

    <div class="expected should-pass">
      Overlay has pointer-events:none, so elementFromPoint() returns the button underneath. Hover should succeed.
    </div>

    <div class="actual">
      <div class="test-container">
        <button id="passthrough-overlay-btn" class="hover-test-btn" style="background: #4caf50; color: white;">
          Hover Occlusion Test 6 passed: Overlay has pointer-events:none
        </button>
        <div class="overlay" style="top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 255, 0.3); pointer-events: none;"></div>
      </div>
    </div>
  </section>

  <!-- ===================================================================== -->
  <!-- TEST 7: No Overlay (SHOULD PASS)                                      -->
  <!-- ===================================================================== -->

  <section id="test-7" class="test-case">
    <h2>
      <span class="test-number pass">7</span>
      No Overlay (Baseline)
    </h2>
    <span class="technique-tag pass">No obstruction</span>
    <span class="technique-tag pass">SHOULD PASS</span>

    <div class="expected should-pass">
      No overlay covering the button. Hover should succeed. Button turns green on hover.
    </div>

    <div class="actual">
      <button id="no-overlay-btn" class="hover-test-btn">
        Hover Occlusion Test 7 passed: No overlay, normal button
      </button>
    </div>
  </section>

  <!-- ===================================================================== -->
  <!-- TEST 8: Nested Element (Child of Target) (SHOULD PASS)                -->
  <!-- ===================================================================== -->

  <section id="test-8" class="test-case">
    <h2>
      <span class="test-number pass">8</span>
      Nested Element (Child of Target)
    </h2>
    <span class="technique-tag pass">Clicking child element</span>
    <span class="technique-tag pass">SHOULD PASS</span>

    <div class="expected should-pass">
      elementFromPoint() returns a child element inside the button. Since target.contains(atPoint) is true, hover should succeed.
    </div>

    <div class="actual">
      <button id="nested-child-btn" class="hover-test-btn" style="padding: 20px 40px;">
        <span style="font-weight: bold; background: #ffeb3b; padding: 5px;">
          Hover Occlusion Test 8 passed
        </span>
        <br>
        <small>Button with nested span element</small>
      </button>
    </div>
  </section>

  <!-- ===================================================================== -->
  <!-- JAVASCRIPT FOR DYNAMIC TESTS                                          -->
  <!-- ===================================================================== -->

  <script>
    // Modal controls
    function showModal() {
      document.getElementById('modal-overlay').style.display = 'block';
      document.getElementById('modal-content').style.display = 'block';
    }

    function hideModal() {
      document.getElementById('modal-overlay').style.display = 'none';
      document.getElementById('modal-content').style.display = 'none';
    }

    // Dropdown controls
    function toggleDropdown() {
      const dropdown = document.getElementById('dropdown-menu');
      dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
    }

    // Toast controls
    function showToast() {
      const toast = document.getElementById('toast');
      toast.style.display = 'block';
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }

    // Hover event logging
    document.querySelectorAll('.hover-test-btn').forEach(btn => {
      btn.addEventListener('mouseenter', function() {
        console.log(`[HOVER] mouseenter fired on: ${this.id}`);
        this.dataset.hoverDetected = 'true';
      });
    });

    // Validation helper - check what elementFromPoint returns
    window.checkOcclusion = function(buttonId) {
      const btn = document.getElementById(buttonId);
      if (!btn) return { error: 'Button not found' };

      const rect = btn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const elementAtPoint = document.elementFromPoint(centerX, centerY);

      return {
        buttonId,
        centerX,
        centerY,
        elementAtPoint: elementAtPoint ? {
          tagName: elementAtPoint.tagName,
          id: elementAtPoint.id,
          className: elementAtPoint.className
        } : null,
        isTarget: elementAtPoint === btn,
        isChildOfTarget: btn.contains(elementAtPoint),
        wouldPass: elementAtPoint === btn || btn.contains(elementAtPoint)
      };
    };

    // Check all occlusion states
    window.checkAllOcclusion = function() {
      const buttons = [
        'modal-covered-btn',
        'center-covered-btn',
        'transparent-overlay-btn',
        'dropdown-covered-btn',
        'toast-covered-btn',
        'passthrough-overlay-btn',
        'no-overlay-btn',
        'nested-child-btn'
      ];
      return buttons.map(id => window.checkOcclusion(id));
    };
  </script>

  <!-- ===================================================================== -->
  <!-- VALIDATION SECTION                                                    -->
  <!-- ===================================================================== -->

  <footer style="margin-top: 40px; padding: 20px; background: #f0f0f0; border-radius: 8px;">
    <h2>Validation Checklist</h2>

    <h3>Tests Expected to FAIL (Element Obscured)</h3>
    <ul>
      <li><strong>Test 1:</strong> Modal overlay - Click "Show Modal" first, then hover button</li>
      <li><strong>Test 2:</strong> Partial overlay - Overlay covers button center</li>
      <li><strong>Test 3:</strong> Transparent overlay - Semi-transparent but still blocks</li>
      <li><strong>Test 4:</strong> Dropdown - Click "Toggle Dropdown" first, then hover button</li>
      <li><strong>Test 5:</strong> Toast - Click "Show Toast" first, then hover button (3s timeout)</li>
    </ul>

    <h3>Tests Expected to PASS</h3>
    <ul>
      <li><strong>Test 6:</strong> pointer-events:none overlay - Clicks pass through</li>
      <li><strong>Test 7:</strong> No overlay - Normal button</li>
      <li><strong>Test 8:</strong> Nested child - Child of target is acceptable</li>
    </ul>

    <h3>JavaScript Validation Helper</h3>
    <pre style="background: #e0e0e0; padding: 10px; border-radius: 4px; overflow-x: auto;">
// Check what element is at button center:
window.checkOcclusion('modal-covered-btn')

// Check all buttons:
window.checkAllOcclusion()
    </pre>

    <h3>Error Message Format</h3>
    <pre style="background: #ffcdd2; padding: 10px; border-radius: 4px;">
"Element '#selector' is obscured by another element at its center. A modal, overlay, or other element may be blocking it."
    </pre>
  </footer>

</body>
</html>