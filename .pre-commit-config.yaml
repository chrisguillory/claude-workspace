# Pre-commit hooks using project virtualenv via uv
#
# This configuration uses `language: system` to run hooks in the project's
# virtualenv rather than creating isolated pip-based environments. This:
#   - Eliminates dependency duplication (deps only in pyproject.toml)
#   - Uses uv for fast, reproducible installs via uv.lock
#   - Ensures hooks use exact same versions as development
#
# IMPORTANT: Run `uv sync --all-groups` before committing to ensure
# all dev dependencies (ruff, mypy, etc.) are installed.

repos:
  - repo: local
    hooks:
      - id: ruff
        name: ruff
        description: Run ruff linter with auto-fix
        entry: uv run ruff check --fix .
        language: system
        pass_filenames: false
        always_run: true

      - id: ruff-format
        name: ruff-format
        description: Run ruff formatter
        entry: uv run ruff format .
        language: system
        pass_filenames: false
        always_run: true

      - id: mypy
        name: mypy
        description: Run mypy type checker
        entry: uv run mypy --config-file=pyproject.toml .
        language: system
        pass_filenames: false
        always_run: true

      - id: strict-typing-linter
        name: strict-typing-linter
        description: Check for mutable/loose types in annotations
        entry: ./scripts/strict_typing_linter.py mcp/document-search/ scripts/
        language: system
        pass_filenames: false
        always_run: true

      - id: exception-safety-linter
        name: exception-safety-linter
        description: Check for exception handling anti-patterns
        entry: ./scripts/exception_safety_linter.py mcp/document-search/ scripts/
        language: system
        pass_filenames: false
        always_run: true